{% schema %}
{
  "name": "Premium  Collection",
  "settings": [
    {
      "type": "text",
      "id": "section_title",
      "label": "Section Title",
      "default": "Premium  Collection"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Select Collection"
    },
    {
      "type": "range",
      "id": "cards_per_row_mobile",
      "label": "Cards per Row on Mobile",
      "min": 1,
      "max": 6,
      "step": 1,
      "default": 1
    },
    {
      "type": "range",
      "id": "cards_per_row_desktop",
      "label": "Cards per Row on Desktop",
      "min": 1,
      "max": 6,
      "step": 1,
      "default": 3
    },
    {
      "type": "checkbox",
      "id": "show_tags",
      "label": "Show Product Tags",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_trust_badges",
      "label": "Show Trust Badges",
      "default": true
    }
  ],
  "blocks": [],
  "presets": [
    {
      "name": "Premium Collection",
      "category": "Products"
    }
  ]
}
{% endschema %}

{% style %}
  #premium-product-section {
    background-color: #f8f8f8;
  }
  #premium-product-section h2.section-title {
    text-align: center;
    font-size: 1rem;
    font-weight: bold;
    color: #333;
    margin-bottom: 50px;
  }
  .premium-collection-grid__grid {
    display: grid;
    grid-template-columns: repeat({{ section.settings.cards_per_row_mobile }}, 1fr);
    gap: 15px;
    padding: 0 15px;
  }
  .product-card {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    background: #fff;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
    cursor: pointer;
    text-align: center;
    height: 100%;
    text-decoration: none;
    color: inherit;
  }
  .product-card:hover {
    box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    transform: translateY(-3px);
  }
  .product-card .image-wrapper {
    width: 100%;
    position: relative;
    padding-top: 100%;
    overflow: hidden;
  }
  .product-card .image-wrapper img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    padding:8px;
    border-radius:16px;
  }
  .product-card .product-content {
    padding: 0px 8px 15px 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
    text-align: center;
    flex-grow: 1;
    width:100%;
  }
  .product-card .product-content h2 {
    font-size: 1rem;
    font-weight: 600;
    margin: 10px 0 5px 0;
    color: black;
    text-align: center;
  }
  .product-card .product-content p {
    font-size: 0.9rem;
    color: #555;
    margin-bottom: 4px;
    text-overflow: ellipsis;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
  }
  .trust-badges {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 8px;
    margin-top: 10px;
    position: absolute;
    top: 3px;
    left: 4px;
  }
  .trust-badges .badge {
    display: inline-block;
    background-image: url(https://cdn.shopify.com/s/files/1/0878/4907/4985/files/Rectangle_46_1.png?v=1747294058);
    background-size: cover;
    background-repeat: no-repeat;
    color: #fff;
    padding: 3px 6px 7px 6px;
    font-size: 0.7rem;
    text-align: left;
  }
  .product-card .tags {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 8px;
    margin-top: 10px;
  }
  .product-card .tags span {
    background: #007bff;
    color: #fff;
    padding: 5px 10px;
    font-size: 0.8rem;
    border-radius: 15px;
  }
  .view-button, .product-card__add-to-cart {
    background: #000;
    color: #fff;
    padding: 6px 20px;
    border-radius: 8px;
    width: 100%;
    margin-top: 4px;
    border: none;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 600;
    transition: all 0.3s ease;
    box-sizing: border-box;
  }
  .view-button:hover, .product-card__add-to-cart:hover {
    background: #333;
    transform: translateY(-1px);
  }
  .rating-badge {
    display: inline-flex;
    align-items: center;
    color: #333;
    padding: 4px 8px;
    border-radius: 50px;
    font-weight: 600;
    gap: 4px;
  }
  .rating-badge .star-icon {
    width: 12px;
    height: 12px;
    color: #FFD700;
  }
  .rating-badge .rating-separator {
    margin: 0 4px;
    color: #333;
  }
  @media (min-width: 768px) {
    .premium-collection-grid__grid {
      grid-template-columns: repeat({{ section.settings.cards_per_row_desktop }}, 1fr);
      gap: 20px;
      padding: 0 20px;
    }
    .product-card .product-content form {
      width: 100%;
    }
    .product-card__add-to-cart.view-button {
      width: 100%;
      box-sizing: border-box;
    }
  }
  @media (max-width: 767px) {
    .premium-collection-grid__grid {
      grid-template-columns: repeat({{ section.settings.cards_per_row_mobile }}, 1fr);
      gap: 15px;
      padding: 0 15px;
    }
  }
{% endstyle %}

<div id="premium-product-section">
  {% if section.settings.section_title != blank %}
    <h2 class="section-title">{{ section.settings.section_title }}</h2>
  {% endif %}
  <div class="premium-collection-grid__grid">
    {% assign coll = collections[section.settings.collection] %}
    {% for product in coll.products %}
      <a 
        href="{{ product.url }}"
        class="product-card"
        data-title="{{ product.title | downcase }}"
      >
        <div class="image-wrapper">
          <img src="{{ product.featured_image | img_url: 'large' }}" alt="{{ product.title }}">
        </div>
        <div class="product-content">
          <h2>{{ product.title }}</h2>
          {% assign avg_rating = product.metafields.reviews.rating.value %}
          {% assign rating_count = product.metafields.reviews.rating_count %}
          {% if avg_rating and rating_count > 0 %}
            <div class="rating-badge">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 20 20" fill="#FFD700" class="star-icon">
                <g clip-path="url(#clip0)">
                  <path d="M19.5399 6.85L13.6199 5.5L10.5099 0.29C10.3999 0.11 10.2099 0 9.99993 0C9.78993 0 9.59993 0.11 9.48993 0.29L6.37993 5.5L0.45993 6.85C0.25993 6.9 0.0899297 7.05 0.0299297 7.25C-0.0300703 7.45 0.00992969 7.67 0.14993 7.83L4.13993 12.4L3.58993 18.44C3.56993 18.65 3.65993 18.85 3.82993 18.98C3.99993 19.1 4.21993 19.13 4.41993 19.05L9.99993 16.64L15.5799 19.03C15.6599 19.06 15.7399 19.08 15.8099 19.08C15.8099 19.08 15.8099 19.08 15.8199 19.08C16.1199 19.09 16.4199 18.82 16.4199 18.48C16.4199 18.42 16.4099 18.36 16.3899 18.31L15.8499 12.38L19.8399 7.81C19.9799 7.65 20.0199 7.43 19.9599 7.23C19.9099 7.04 19.7399 6.89 19.5399 6.85Z"/>
                </g>
                <defs>
                  <clipPath id="clip0">
                    <rect width="20" height="19.08" fill="white"/>
                  </clipPath>
                </defs>
              </svg>
              {{ avg_rating }}
              <span class="rating-separator">|</span>
              {{ rating_count }} Ratings
            </div>
          {% else %}
            <div class="rating-badge">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 20 20" fill="#FFD700" class="star-icon">
                <g clip-path="url(#clip0)">
                  <path d="M19.5399 6.85L13.6199 5.5L10.5099 0.29C10.3999 0.11 10.2099 0 9.99993 0C9.78993 0 9.59993 0.11 9.48993 0.29L6.37993 5.5L0.45993 6.85C0.25993 6.9 0.0899297 7.05 0.0299297 7.25C-0.0300703 7.45 0.00992969 7.67 0.14993 7.83L4.13993 12.4L3.58993 18.44C3.56993 18.65 3.65993 18.85 3.82993 18.98C3.99993 19.1 4.21993 19.13 4.41993 19.05L9.99993 16.64L15.5799 19.03C15.6599 19.06 15.7399 19.08 15.8099 19.08C15.8099 19.08 15.8099 19.08 15.8199 19.08C16.1199 19.09 16.4199 18.82 16.4199 18.48C16.4199 18.42 16.4099 18.36 16.3899 18.31L15.8499 12.38L19.8399 7.81C19.9799 7.65 20.0199 7.43 19.9599 7.23C19.9099 7.04 19.7399 6.89 19.5399 6.85Z"/>
                </g>
                <defs>
                  <clipPath id="clip0">
                    <rect width="20" height="19.08" fill="white"/>
                  </clipPath>
                </defs>
              </svg>
              4.9
              <span class="rating-separator">|</span>
              0
            </div>
          {% endif %}
          {% if section.settings.show_trust_badges and product.metafields.custom.trust_badge %}
            <div class="trust-badges">
              {% assign badges = product.metafields.custom.trust_badge | remove: '[' | remove: ']' | remove: '"' | split: ',' %}
              {% if badges[0] != '' %}
                <div class="badge">{{ badges[0] | strip }}</div>
              {% endif %}
            </div>
          {% endif %}
          {% if section.settings.show_tags %}
            <div class="tags">
              {% for tag in product.tags %}
                <span>{{ tag }}</span>
              {% endfor %}
            </div>
          {% endif %}

          {%- assign price = product.price | money_without_trailing_zeros -%}
          {%- assign compare_at_price = product.compare_at_price | money_without_trailing_zeros -%}
          {%- if product.compare_at_price > product.price -%}
            {%- assign discount = 100 | times: product.price | divided_by: product.compare_at_price | minus: 100 | abs -%}
          {%- else -%}
            {%- assign discount = 0 -%}
          {%- endif -%}
          <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
            <span style="font-weight: bold; font-size: 1.2em; color: #111;">{{ price }}</span>
            {%- if product.compare_at_price > product.price -%}
              <span style="text-decoration: line-through; color: #888; font-size: 1em;">{{ compare_at_price }}</span>
              <span style="color: #228B22; font-weight: bold; font-size: 1.1em;">{{ discount | round }}% </span>
              <span style="color: #228B22; font-weight: bold; font-size: 1.1em;">+ Extra 20% OFF</span>
            {%- endif -%}
          </div>

          <form
            method="post"
            action="/cart/add"
            accept-charset="UTF-8"
            class="form"
            enctype="multipart/form-data"
            novalidate
            data-type="add-to-cart-form"
            x-data="xProductCart()"
            x-ref="product_form"
          >
            <input type="hidden" name="form_type" value="product">
            <input type="hidden" name="utf8" value="âœ“">
            <input type="hidden" name="id" value="{{ product.variants.first.id }}">
            <button
              type="button"
              class="product-card__add-to-cart view-button"
              aria-label="Add to cart"
              @click="addToCart($event, true)"
              x-intersect.once.margin.200px="Alpine.store('xCartHelper').validateCart();"
            >
              ADD TO CART
            </button>
          </form>
        </div>
      </a>
    {% endfor %}
  </div>
</div> 