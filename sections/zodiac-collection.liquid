{% schema %}
  {
    "name": "Zodiac Collection",
    "settings": [
      {
        "type": "text",
        "id": "section_title",
        "label": "Section Title",
        "default": "Our Gemstone Collection"
      },
      {
        "type": "collection",
        "id": "collection",
        "label": "Select Collection"
      },
      {
        "type": "range",
        "id": "cards_per_row_mobile",
        "label": "Cards per Row on Mobile",
        "min": 1,
        "max": 6,
        "step": 1,
        "default": 1
      },
      {
        "type": "range",
        "id": "cards_per_row_desktop",
        "label": "Cards per Row on Desktop",
        "min": 1,
        "max": 6,
        "step": 1,
        "default": 3
      },
      {
        "type": "checkbox",
        "id": "show_tags",
        "label": "Show Product Tags",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "show_trust_badges",
        "label": "Show Trust Badges",
        "default": true
      }
    ],
    "blocks": [],
    "presets": [
      {
        "name": "Zodiac Collection",
        "category": "Products"
      }
    ]
  }
  {% endschema %}
  
  {% style %}
    /* General Section Styling */
    #product-section {
      background-color: #f8f8f8;
    }
  
    /* Section Title */
    #product-section h2.section-title {
      text-align: center;
      font-size: 14px;
      font-weight: bold;
      color: #333;
      margin-bottom: 50px;
    }

    /* Desktop Filter Container - Horizontal Layout */
    .filters-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f8f8f8;
      padding: 30px 20px 40px 20px;
      margin: 0;
    }

    /* Category Tabs - Desktop Style */
    .category-tabs-desktop {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .category-tabs-desktop .tab {
      background: #fff;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 12px 24px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 1rem;
      font-weight: 500;
      color: #333;
      text-align: center;
    }

    .category-tabs-desktop .tab:hover {
      border-color: #007bff;
      background: #f8f9ff;
    }

    .category-tabs-desktop .tab.active {
      border-color: #007bff;
      background: #007bff;
      color: #fff;
    }

    /* Zodiac Filter - Desktop */
    .zodiac-filter-desktop {
      position: relative;
      width: 200px;
    }

    /* Mobile Category Tabs - Image Style */  
    .category-tabs-mobile {
      display: none;
      justify-content: space-evenly;
      gap: 0px;
      background: #f8f8f8;
      padding: 16px 0 20px 0;
    }

    .category-tabs-mobile .tab {
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      transition: all 0.2s ease;
      padding: 8px;
      border-radius: 12px;
      width: 100px;
      height: 100px;
      justify-content: center;
    }

    .category-tabs-mobile .tab.active {
      background: rgba(0, 123, 255, 0.1);
    }

    .category-tabs-mobile .tab img {
      width: 60px;
      height: 60px;
      object-fit: contain;
      margin-bottom: 8px;
      display: block;
    }

    .category-tabs-mobile .tab-label {
      font-size: 0.85rem;
      font-weight: 600;
      color: #111;
      text-align: center;
      line-height: 1.2;
      letter-spacing: 0.5px;
    }

    /* Mobile Zodiac Filter */
    .zodiac-filter-mobile {
      display: none;
      padding: 0 15px;
      margin-bottom: 20px;
    }
  
    /* Custom Dropdown Styling */
    .custom-dropdown {
      position: relative;
      width: 100%;
      max-width: 400px;
      margin: 0 auto;
      display: block;
    }
  
    .dropdown-selected {
      display: flex;
      justify-content: space-between;
      padding: 8px 15px;
      font-size: 1rem;
      border-radius: 8px;
      border: none;
      background-color: #fff;
      cursor: pointer;
      width: 100%;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      align-items: center;
    }
  
    .dropdown-selected:after {
      content: '';
      width: 10px;
      height: 10px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%23333' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: center;
      transition: transform 0.3s ease;
    }
  
    .dropdown-selected.active:after {
      transform: rotate(180deg);
    }
  
    .dropdown-options {
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      max-height: 250px;
      overflow-y: auto;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 100;
      display: none;
      margin-top: 5px;
    }
  
    .dropdown-options.show {
      display: block;
    }
  
    .dropdown-option {
      padding: 8px 15px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
  
    .dropdown-option:hover {
      background-color: #f5f5f5;
    }
  
    .dropdown-option.selected {
      background-color: #e6f7ff;
    }
  
    /* General Product Cards */
    .product-card {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      background: #fff;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      cursor: pointer;
      text-align: center;
      height: 100%;
      text-decoration: none;
      color: inherit;
    }
  
    .product-card:hover {
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
      transform: translateY(-3px);
    }
  
    .product-card .image-wrapper {
      width: 100%;
      position: relative;
      padding-top: 100%; /* Makes it square */
      overflow: hidden;
    }
  
    .product-card .image-wrapper img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      padding:8px;
      border-radius:16px;
    }
  
    .product-card .product-content {
      padding: 0px 8px 15px 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      text-align: center;
      flex-grow: 1;
      width:100%;
    }
  
    .product-card .product-content h2 {
      font-size: 1rem;
      font-weight: 500;
      margin: 10px 0 5px 0;
      color: black;
      text-align: center;
      font-family : "Metropolis", sans-serif;
    }
  
    .product-card .product-content p {
      font-size: 0.9rem;
      color: #555;
      margin-bottom: 4px;
      text-overflow: ellipsis;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
    }
  
    /* Trust Badges */
    .trust-badges {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      margin-top: 10px;
      position: absolute;
      top: 3px;
      left: 4px;
    }
  
    .trust-badges .badge {
    display: inline-block;
    background-image: url(https://cdn.shopify.com/s/files/1/0878/4907/4985/files/Rectangle_46_1.png?v=1747294058);
    background-size: cover;
    background-repeat: no-repeat;
    color: #fff;
    padding: 3px 6px 7px 6px;
    font-size: 0.7rem;
    text-align: left;
}
  
    /* Tags Display */
    .product-card .tags {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      margin-top: 10px;
    }
  
    .product-card .tags span {
      background: #007bff;
      color: #fff;
      padding: 5px 10px;
      font-size: 0.8rem;
      border-radius: 15px;
    }
  
    /* Responsive Layout */
    .collection-grid-simple__grid {
      display: grid;
      grid-template-columns: repeat({{ section.settings.cards_per_row_mobile }}, 1fr);
      gap: 15px;
      padding: 0 15px;
    }
    .view-button {
      background: #000;
      color: #fff;
      padding: 6px 20px;
      border-radius: 8px;
      width: 100%;
      margin-top: 4px;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .view-button:hover {
      background: #333;
      transform: translateY(-1px);
    }

    /* Desktop Styles */
    @media (min-width: 768px) {
      .collection-grid-simple__grid {
        grid-template-columns: repeat({{ section.settings.cards_per_row_desktop }}, 1fr);
        gap: 20px;
        padding: 0 20px;
      }
      
      .custom-dropdown {
        width: 200px;
      }

      /* Show desktop layout */
      .filters-container {
        display: flex;
      }

      .category-tabs-desktop {
        display: flex;
      }

      .zodiac-filter-desktop {
        display: block;
      }

      /* Hide mobile layout */
      .category-tabs-mobile {
        display: none;
      }

      .zodiac-filter-mobile {
        display: none;
      }

      /* Fix Add to Cart button width on desktop */
      .product-card .product-content form {
        width: 100%;
      }
      .product-card__add-to-cart.view-button {
        width: 100%;
        box-sizing: border-box;
      }
    }

    /* Mobile Styles */
    @media (max-width: 767px) {
      /* Hide desktop layout */
      .filters-container {
        display: none;
      }

      .category-tabs-desktop {
        display: none;
      }

      .zodiac-filter-desktop {
        display: none;
      }

      /* Show mobile layout */
      .category-tabs-mobile {
        display: flex;
      }

      .zodiac-filter-mobile {
        display: block;
      }
      
      .custom-dropdown {
        width: 100%;
        max-width: 100%;
      }
      
      .dropdown-selected {
        font-size: 0.9rem;
        padding: 8px 10px;
      }
    }
  
    /* No Results Message */
    .no-results {
      text-align: center;
      padding: 30px;
      grid-column: 1 / -1;
      color: #666;
      font-size: 1.1rem;
      display: none;
    }

    /* Rating Badge Styles */
    .rating-badge {
      display: inline-flex;
      align-items: center;
      color: #333;
      padding: 4px 8px;
      border-radius: 50px;
      font-weight: 600;
      gap: 4px;
    }

    .rating-badge .star-icon {
      width: 12px;
      height: 12px;
      color: #FFD700;
    }

    .rating-badge .rating-separator {
      margin: 0 4px;
      color: #333;
    }

    .product-pricing {
      margin: 8px 0 4px 0;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .product-price {
      color: #111;
      font-weight: bold;
    }
    .product-compare-at-price {
      text-decoration: line-through;
      color: #888;
    }
    .product-discount,
    .product-discount-percent {
      color: #2ecc40;
      font-weight: 600;
      margin-left: 4px;
      font-size: 0.98em;
    }
  {% endstyle %}
  
  <div id="product-section">
    {% if section.settings.section_title != blank %}
      <h2 class="section-title">{{ section.settings.section_title }}</h2>
    {% endif %}
  
    <!-- Desktop Filter Container -->
    <div class="filters-container">
      <!-- Category Tabs - Desktop (Text Only) -->
      <div class="category-tabs-desktop">
        <div class="tab" data-category="bracelet">BRACELETS</div>
        <div class="tab" data-category="pendant">PENDANTS</div>
        <div class="tab" data-category="box">BOXES</div>
      </div>

      <!-- Zodiac Filter - Desktop -->
      <div class="zodiac-filter-desktop">
        <div class="custom-dropdown" id="dropdown-zodiac-desktop">
          <div class="dropdown-selected" data-value="">Filter by Zodiac</div>
          <div class="dropdown-options">
            <div class="dropdown-option" data-value="">All Zodiacs</div>
            {% assign zodiacs = 'Aries,Taurus,Gemini,Cancer,Leo,Virgo,Libra,Scorpio,Sagittarius,Capricorn,Aquarius,Pisces' | split: ',' %}
            {% for zodiac in zodiacs %}
              <div class="dropdown-option" data-value="{{ zodiac | downcase }}">{{ zodiac }}</div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>

    <!-- Mobile Category Tabs (With Images) -->
    <div class="category-tabs-mobile">
      <div class="tab" data-category="bracelet">
        <img src="https://cdn.shopify.com/s/files/1/0878/4907/4985/files/icon_2.webp?v=1751522913" alt="Bracelets" />
        <div class="tab-label">BRACELETS</div>
      </div>
      <div class="tab" data-category="pendant">
        <img src="https://cdn.shopify.com/s/files/1/0878/4907/4985/files/icon_3.webp?v=1751522913" alt="Pendants" />
        <div class="tab-label">PENDANTS</div>
      </div>
      <div class="tab" data-category="box">
        <img src="https://cdn.shopify.com/s/files/1/0878/4907/4985/files/icon_1.webp?v=1751522914" alt="Boxes" />
        <div class="tab-label">BOXES</div>
      </div>
    </div>

    <!-- Mobile Zodiac Filter -->
    <div class="zodiac-filter-mobile">
      <div class="custom-dropdown" id="dropdown-zodiac-mobile">
        <div class="dropdown-selected" data-value="">Filter by Zodiac</div>
        <div class="dropdown-options">
          <div class="dropdown-option" data-value="">All Zodiacs</div>
          {% assign zodiacs = 'Aries,Taurus,Gemini,Cancer,Leo,Virgo,Libra,Scorpio,Sagittarius,Capricorn,Aquarius,Pisces' | split: ',' %}
          {% for zodiac in zodiacs %}
            <div class="dropdown-option" data-value="{{ zodiac | downcase }}">{{ zodiac }}</div>
          {% endfor %}
        </div>
      </div>
    </div>
  
    <!-- Product Cards -->
    <div class="collection-grid-simple__grid">
      <div class="no-results">No products match your selected filters.</div>
      
      {% assign coll = collections[section.settings.collection] %}
      {% for product in coll.products %}
        
        <a 
          href="{{ product.url }}"
          class="product-card"
          data-zodiac="{{ product.metafields.custom.zodiac | remove: '[' | remove: ']' | remove: '"' | strip | downcase }}"
          data-title="{{ product.title | downcase }}"
        >
          <div class="image-wrapper">
            <img src="{{ product.featured_image | img_url: 'large' }}" alt="{{ product.title }}">
          </div>
          <div class="product-content">
            <h2>{{ product.title }}</h2>
            <div class="product-pricing">
              {% assign first_variant = product.variants.first %}
              <span class="product-price">
                {{ first_variant.price | money }}
              </span>
              {% if first_variant.compare_at_price > first_variant.price %}
                <span class="product-compare-at-price">
                  {{ first_variant.compare_at_price | money }}
                </span>
                {% assign discount = first_variant.compare_at_price | minus: first_variant.price %}
                {% assign discount_percent = discount | times: 100 | divided_by: first_variant.compare_at_price %}
                <span class="product-discount-percent">
                  {{ discount_percent }}% OFF
                </span>
              {% endif %}
            </div>
            
            <!-- Start of Judge.me code -->
            {% assign avg_rating = product.metafields.reviews.rating.value %}
            {% assign rating_count = product.metafields.reviews.rating_count %}
            
            {% if avg_rating and rating_count > 0 %}
              <div class="rating-badge">
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 20 20" fill="#FFD700" class="star-icon">
                  <g clip-path="url(#clip0)">
                    <path d="M19.5399 6.85L13.6199 5.5L10.5099 0.29C10.3999 0.11 10.2099 0 9.99993 0C9.78993 0 9.59993 0.11 9.48993 0.29L6.37993 5.5L0.45993 6.85C0.25993 6.9 0.0899297 7.05 0.0299297 7.25C-0.0300703 7.45 0.00992969 7.67 0.14993 7.83L4.13993 12.4L3.58993 18.44C3.56993 18.65 3.65993 18.85 3.82993 18.98C3.99993 19.1 4.21993 19.13 4.41993 19.05L9.99993 16.64L15.5799 19.03C15.6599 19.06 15.7399 19.08 15.8099 19.08C15.8099 19.08 15.8099 19.08 15.8199 19.08C16.1199 19.09 16.4199 18.82 16.4199 18.48C16.4199 18.42 16.4099 18.36 16.3899 18.31L15.8499 12.38L19.8399 7.81C19.9799 7.65 20.0199 7.43 19.9599 7.23C19.9099 7.04 19.7399 6.89 19.5399 6.85Z"/>
                  </g>
                  <defs>
                    <clipPath id="clip0">
                      <rect width="20" height="19.08" fill="white"/>
                    </clipPath>
                  </defs>
                </svg>
                {{ avg_rating }}
                <span class="rating-separator">|</span>
                {{ rating_count }} Ratings
              </div>
            {% else %}
              <div class="rating-badge">
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 20 20" fill="#FFD700" class="star-icon">
                  <g clip-path="url(#clip0)">
                    <path d="M19.5399 6.85L13.6199 5.5L10.5099 0.29C10.3999 0.11 10.2099 0 9.99993 0C9.78993 0 9.59993 0.11 9.48993 0.29L6.37993 5.5L0.45993 6.85C0.25993 6.9 0.0899297 7.05 0.0299297 7.25C-0.0300703 7.45 0.00992969 7.67 0.14993 7.83L4.13993 12.4L3.58993 18.44C3.56993 18.65 3.65993 18.85 3.82993 18.98C3.99993 19.1 4.21993 19.13 4.41993 19.05L9.99993 16.64L15.5799 19.03C15.6599 19.06 15.7399 19.08 15.8099 19.08C15.8099 19.08 15.8099 19.08 15.8199 19.08C16.1199 19.09 16.4199 18.82 16.4199 18.48C16.4199 18.42 16.4099 18.36 16.3899 18.31L15.8499 12.38L19.8399 7.81C19.9799 7.65 20.0199 7.43 19.9599 7.23C19.9099 7.04 19.7399 6.89 19.5399 6.85Z"/>
                  </g>
                  <defs>
                    <clipPath id="clip0">
                      <rect width="20" height="19.08" fill="white"/>
                    </clipPath>
                  </defs>
                </svg>
                4.9
                <span class="rating-separator">|</span>
                0
              </div>
            {% endif %}
            <!-- End of Judge.me code -->
                        
            {% if section.settings.show_trust_badges and product.metafields.custom.trust_badge %}
              <div class="trust-badges">
                {% assign badges = product.metafields.custom.trust_badge
                  | remove: '['
                  | remove: ']'
                  | remove: '"'
                  | split: ','
                %}
                {% if badges[0] != '' %}
                  <div class="badge">{{ badges[0] | strip }}</div>
                {% endif %}
              </div>
            {% endif %}
            
            {% if section.settings.show_tags %}
              <div class="tags">
                {% for tag in product.tags %}
                  <span>{{ tag }}</span>
                {% endfor %}
              </div>
            {% endif %}
             
            <form
              method="post"
              action="/cart/add"
              accept-charset="UTF-8"
              class="form"
              enctype="multipart/form-data"
              novalidate
              data-type="add-to-cart-form"
              x-data="xProductCart()"
              x-ref="product_form"
            >
              <input type="hidden" name="form_type" value="product">
              <input type="hidden" name="utf8" value="âœ“">
              <input type="hidden" name="id" value="{{ product.variants.first.id }}">

              <button
                type="button"
                class="product-card__add-to-cart view-button"
                aria-label="Add to cart"
                @click="addToCart($event, true)"
                x-intersect.once.margin.200px="Alpine.store('xCartHelper').validateCart();"
              >
                ADD TO CART
              </button>
            </form>
          </div>
        </a>
      {% endfor %}
    </div>
  </div>
  
  <script>
  document.addEventListener("DOMContentLoaded", function() {
    // Initialize custom dropdowns for both desktop and mobile
    initCustomDropdowns();
    // Initialize category tabs for both desktop and mobile
    initCategoryTabs();
    // Apply filters on initial load
    applyFilters();

    function initCustomDropdowns() {
      // Initialize both desktop and mobile dropdowns
      const dropdowns = document.querySelectorAll('#dropdown-zodiac-desktop, #dropdown-zodiac-mobile');
      
      dropdowns.forEach(dropdown => {
        const selected = dropdown.querySelector('.dropdown-selected');
        const options = dropdown.querySelector('.dropdown-options');
        const optionItems = options.querySelectorAll('.dropdown-option');
        
        selected.addEventListener('click', () => {
          selected.classList.toggle('active');
          options.classList.toggle('show');
        });
        
        optionItems.forEach(option => {
          option.addEventListener('click', () => {
            const value = option.getAttribute('data-value');
            selected.textContent = option.textContent;
            selected.setAttribute('data-value', value);
            optionItems.forEach(item => item.classList.remove('selected'));
            option.classList.add('selected');
            options.classList.remove('show');
            selected.classList.remove('active');
            
            // Sync both dropdowns
            syncDropdowns(value, option.textContent);
            
            // Deactivate all category tabs when a zodiac is selected
            const desktopTabs = document.querySelectorAll('.category-tabs-desktop .tab');
            const mobileTabs = document.querySelectorAll('.category-tabs-mobile .tab');
            desktopTabs.forEach(tab => tab.classList.remove('active'));
            mobileTabs.forEach(tab => tab.classList.remove('active'));
            
            applyFilters();
          });
        });
        
        document.addEventListener('click', event => {
          if (!dropdown.contains(event.target)) {
            options.classList.remove('show');
            selected.classList.remove('active');
          }
        });
      });
    }

    function syncDropdowns(value, text) {
      const dropdowns = document.querySelectorAll('#dropdown-zodiac-desktop, #dropdown-zodiac-mobile');
      dropdowns.forEach(dropdown => {
        const selected = dropdown.querySelector('.dropdown-selected');
        const optionItems = dropdown.querySelectorAll('.dropdown-option');
        
        selected.textContent = text;
        selected.setAttribute('data-value', value);
        optionItems.forEach(item => {
          item.classList.remove('selected');
          if (item.getAttribute('data-value') === value) {
            item.classList.add('selected');
          }
        });
      });
    }

    function initCategoryTabs() {
      // Initialize both desktop and mobile tabs
      const desktopTabs = document.querySelectorAll('.category-tabs-desktop .tab');
      const mobileTabs = document.querySelectorAll('.category-tabs-mobile .tab');
      const allTabs = [...desktopTabs, ...mobileTabs];
      
      allTabs.forEach(tab => {
        tab.addEventListener('click', function() {
          const category = this.getAttribute('data-category');
          
          // If the clicked tab is already active, deactivate it
          if (this.classList.contains('active')) {
            // Deactivate all tabs
            allTabs.forEach(t => t.classList.remove('active'));
          } else {
            // Deactivate all tabs and activate the clicked one and its counterpart
            allTabs.forEach(t => {
              if (t.getAttribute('data-category') === category) {
                t.classList.add('active');
              } else {
                t.classList.remove('active');
              }
            });
          }
          
          // Reset zodiac filter when a category is selected
          const dropdowns = document.querySelectorAll('#dropdown-zodiac-desktop, #dropdown-zodiac-mobile');
          dropdowns.forEach(dropdown => {
            const selected = dropdown.querySelector('.dropdown-selected');
            const optionItems = dropdown.querySelectorAll('.dropdown-option');
            selected.textContent = 'Filter by Zodiac';
            selected.setAttribute('data-value', '');
            optionItems.forEach(item => item.classList.remove('selected'));
            optionItems[0].classList.add('selected'); // Mark 'All Zodiacs' as selected
          });
          
          applyFilters();
        });
      });
    }

    function applyFilters() {
      // Get filter values from both desktop and mobile (they should be synced)
      const desktopZodiacFilter = document.querySelector('#dropdown-zodiac-desktop .dropdown-selected').getAttribute('data-value').toLowerCase();
      const zodiacFilter = desktopZodiacFilter;
      
      const activeDesktopTab = document.querySelector('.category-tabs-desktop .tab.active');
      const activeMobileTab = document.querySelector('.category-tabs-mobile .tab.active');
      const categoryFilter = (activeDesktopTab || activeMobileTab) ? 
        (activeDesktopTab || activeMobileTab).getAttribute('data-category').toLowerCase() : '';
      
      let visibleCount = 0;
      
      document.querySelectorAll('.product-card').forEach(card => {
        const zodiac = card.dataset.zodiac || "";
        const productTitle = card.dataset.title || "";
        
        // Zodiac filter
        let zodiacMatch = zodiacFilter === "";
        if (!zodiacMatch && zodiac) {
          const zodiacWords = zodiac.split(',').map(z => z.trim().toLowerCase());
          zodiacMatch = zodiacWords.some(z => z === zodiacFilter);
        }
        
        // Category filter - check if the product title contains the category word
        let categoryMatch = categoryFilter === "";
        if (!categoryMatch && productTitle) {
          if (categoryFilter === 'pendant') {
            categoryMatch = productTitle.includes('pendant') || productTitle.includes('necklace');
          } else {
            categoryMatch = productTitle.includes(categoryFilter);
          }
        }
        
        if (zodiacMatch && categoryMatch) {
          card.style.display = "flex";
          visibleCount++;
        } else {
          card.style.display = "none";
        }
      });
      
      const noResultsElement = document.querySelector('.no-results');
      noResultsElement.style.display = (visibleCount === 0) ? 'block' : 'none';
    }
  });
  </script>